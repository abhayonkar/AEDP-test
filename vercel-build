#!/bin/bash

# Exit immediately if a command exits with a non-zero status.
# This helps to catch errors early in the build process.
set -e

# Log a message to the Vercel build console
echo "--- Installing WeasyPrint System Dependencies (Comprehensive) ---"

# Update the package manager cache first to ensure we get the latest package lists.
yum update -y

# Use yum (the package manager in Vercel's Amazon Linux environment)
# to install the system libraries that WeasyPrint depends on.
# This is a more comprehensive list to include common sub-dependencies.
yum install -y pango pango-devel cairo cairo-devel libffi-devel gdk-pixbuf2 gdk-pixbuf2-devel libjpeg-turbo libpng

# Log another message
echo "--- Collecting Django Static Files ---"

# Run the collectstatic command to gather all static files (CSS, JS, images)
# into the directory specified by STATIC_ROOT in your settings.py.
# The --noinput flag prevents any interactive prompts.
# IMPORTANT: Use the same python version as specified in vercel.json
python manage.py collectstatic --noinput --clear
