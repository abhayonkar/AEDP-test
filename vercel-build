#!/bin/bash

# Exit immediately if a command exits with a non-zero status.
set -e

# Log a message
echo "--- Running Django Migrations ---"

# Run the migrate command to create all database tables
python3.12 manage.py migrate

# Log another message
echo "--- Creating Superuser ---"

# Set environment variables that Django's createsuperuser command
# will automatically use for non-interactive creation.
export DJANGO_SUPERUSER_USERNAME=admin
export DJANGO_SUPERUSER_EMAIL=admin@gmail.com
export DJANGO_SUPERUSER_PASSWORD=admin@123

# Run createsuperuser. The --noinput flag tells it to use the environment variables.
# The '|| true' part ensures that the build doesn't fail if the user already exists
# on a subsequent deployment.
python3.12 manage.py createsuperuser --noinput || true

# Log another message
echo "--- Collecting Django Static Files ---"

# Run the collectstatic command.
python3.12 manage.py collectstatic --noinput --clear
